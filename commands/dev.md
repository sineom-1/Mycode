---
description: 官方 feature-dev 开发流程（通用整合版）
argument-hint: Optional feature / change request
---

# 功能开发（以官方 feature-dev 为主）

你正在帮助开发者实现一个新功能或完成一次变更。请按核心流程推进：先深入理解代码库，澄清所有不明确点，设计架构，再实现与质检，最后交付总结。

## 核心原则

- **先问清楚**：识别所有歧义、边界条件、集成点与未定义行为；在进入架构设计/实现前，必须等待用户回答。
- **先理解后行动**：先读现有实现与项目约定，再设计/编码。
- **读 agent 给出的关键文件**：调用 `explorer/architect` 时要求返回 5–10 个“最重要文件”；读完这些文件再继续。
- **简单且优雅**：优先可读、可维护、与现有架构一致；避免过度设计。
- **使用 TodoWrite**：全过程跟踪进度与待确认问题。

---

## Phase 1：Discovery（需求发现）

**目标**：弄清“要做什么”

初始需求：$ARGUMENTS

**行动**：
1. 创建 todo（覆盖所有阶段）
2. 若需求不清晰，询问用户：
   - 要解决什么问题？
   - 期望行为是什么（输入/输出/失败路径）？
   - 有哪些约束（性能/安全/兼容/时限/依赖）？
3. 总结你的理解与验收标准，并请求用户确认

---

## Phase 2：Codebase Exploration（代码库探索）

**目标**：在高层与细节层面理解相关实现与项目约定

**行动**：
1. 并行调用 2–3 次 `explorer`（每次侧重点不同），例如：
   - 查找相似功能并追踪完整流程
   - 梳理该领域的架构与抽象边界
   - 找出 UI/测试/扩展点相关模式（如适用）
2. 要求每次 `explorer` 输出 5–10 个关键文件（含 `file:line`）
3. 读取这些关键文件后，汇总“入口/数据流/关键组件/约定/风险点”

---

## Phase 3：Clarifying Questions（澄清问题）

**目标**：在设计前消除所有歧义

**关键要求**：这是最重要阶段之一，**不得跳过**。

**行动**：
1. 基于 Phase 2 的发现与原始需求，列出所有未定义项：
   - 边界条件、错误处理、集成点、范围边界、设计偏好、向后兼容、性能要求等
2. 用清晰有序的清单把问题问给用户
3. **等待用户回答**，再进入架构设计

如果用户回答“你觉得怎么做都行”，先给出你的推荐，并取得用户明确确认。

---

## Phase 4：Architecture Design（架构设计）

**目标**：设计多个方案并让用户选择

**行动**：
1. 并行调用 2–3 次 `architect`（不同侧重点），例如：
   - 最小改动：改动最少、最大复用
   - 偏整洁：更易维护、边界更清晰
   - 折中方案：速度与质量平衡
2. 对比这些方案，形成你的推荐（含取舍与关键差异）
3. 把对比与推荐发给用户，并请用户选择采用哪一种方案

---

## Phase 5：Implementation（实现）

**目标**：落地实现

**关键要求**：**未得到用户明确批准不得开始实现**。

**行动**：
1. 等待用户明确同意
2. 复读 Phase 2/4 标出的关键文件与约定，避免偏离项目惯例
3. 调用 `coder` 按选定方案实现
4. 严格遵循项目规范与既有代码风格
5. 按进度更新 todo

---

## Phase 6：Quality Review（质量审查）

**目标**：确保代码简单、可读、正确且符合约定

**行动**：
1. 并行调用 3 次 `guardian`（不同侧重点），例如：
   - 简洁/DRY/可维护性
   - Bug/功能正确性
   - 项目约定/抽象边界/兼容性与安全
2. 汇总结果，挑出最高优先级问题
3. 把问题清单发给用户，并询问用户决定（现在修/以后修/按当前交付）
4. 按用户决定修复并再次验证

---

## Phase 7：Summary（总结交付）

**目标**：记录完成内容并明确下一步

**行动**：
1. 标记 todos 完成
2. 必要时调用 `doc-writer` 更新文档（README/API/变更说明等）
3. 总结交付：
   - 做了什么
   - 关键决策与取舍
   - 修改了哪些文件
   - 如何验证（命令/步骤）
   - 下一步建议

