---
name: quality-patterns
description: 质量保障：代码审查、测试策略、调试与问题诊断（语言/框架无关）
---

本 skill 用于在不预设技术栈的前提下，给出可执行的质量保障方法：**少而准的审查结论 + 可重复的验证**。

## 1) 审查清单（按优先级）

### 功能正确性
- 需求符合、边界条件处理、错误路径覆盖
- 并发/竞态/重入风险（如适用）
- 数据一致性与幂等（如涉及写操作/重试）

### 安全与隐私
- 鉴权/授权是否正确
- 注入风险（SQL/命令/模板）、越权、敏感信息泄露
- 输入校验与输出编码

### 兼容性与可运维性
- API/事件/数据结构变更是否向后兼容
- 配置变更是否有默认值与迁移说明
- 日志/指标是否能定位问题且不泄露敏感信息

### 可维护性
- 职责是否清晰（SRP），是否有明显重复（DRY）
- 复杂度是否可控，命名是否表达意图
- 是否引入不必要的抽象/依赖（YAGNI）

### 性能
- 明显的低效循环、N+1、无界缓存/队列、资源泄漏

## 2) 问题分级

- 🔴 严重（Critical）：安全漏洞、数据损坏、明显崩溃、破坏兼容、无法回滚
- 🟡 重要（Major）：缺少关键错误处理、明显技术债、测试缺失导致风险高
- 🟢 建议（Minor）：可读性/一致性/小幅优化

## 3) 测试策略（通用）

按“离变更点最近”原则选择：

1. 单元测试：覆盖核心逻辑与边界条件
2. 集成测试：覆盖模块间交互（DB/HTTP/队列等可用替身）
3. 端到端：覆盖关键用户路径（少而精）

每个关键行为至少包含：成功路径 + 失败路径（或异常路径）。

## 4) 调试与诊断方法

1. 复现：最小复现步骤、输入输出、环境差异
2. 二分：缩小到模块/函数/分支
3. 根因：直接原因 + 触发条件 + 为什么没被测试捕获
4. 修复：最小修复 + 回归范围 + 预防措施

## 5) 审查报告模板

```markdown
## 审查概述
- 范围：...
- 总体评价：✅/🔄/❌

## 问题清单
### 🔴 严重
1. 问题：...
   - 位置：`file:line`
   - 影响：...
   - 建议：...

### 🟡 重要
...

### 🟢 建议
...

## 验证与回归
- 必要测试：...
- 回归路径：...
```

